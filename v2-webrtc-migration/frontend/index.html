<!DOCTYPE html>
<html>
<body style="margin:0;background:black">
  <video id="v" autoplay playsinline></video>

  <script>
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
    });

    pc.ontrack = e => {
      document.getElementById("v").srcObject = e.streams[0];
    };

    const ws = new WebSocket("ws://localhost:9000");

    ws.onmessage = async e => {
        console.log(e)
      const msg = JSON.parse(e.data);

      if (msg.type === "offer") {
        await pc.setRemoteDescription({ type: "offer", sdp: msg.sdp });
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        ws.send(JSON.stringify({ type: "answer", sdp: answer.sdp }));
      }

      if (msg.type === "ice") {
        await pc.addIceCandidate(msg);
      }
    };

    pc.onicecandidate = e => {
        console.log(e)
      if (e.candidate) ws.send(JSON.stringify(e.candidate));
    };
  </script>
</body>
</html>
